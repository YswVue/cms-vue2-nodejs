"use strict";(self["webpackChunkvue2_cms_admin"]=self["webpackChunkvue2_cms_admin"]||[]).push([[621],{4621:function(e,a,r){r.r(a),r.d(a,{default:function(){return u}});var t=function(){var e=this,a=e._self._c;return a("el-card",{staticClass:"box-card"},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[e._v("管理员编辑")])]),a("el-form",{ref:"form",attrs:{rules:e.rules,model:e.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"用户名"}},[a("el-input",{attrs:{readonly:""},model:{value:e.form.username,callback:function(a){e.$set(e.form,"username",a)},expression:"form.username"}})],1),a("el-form-item",{attrs:{prop:"fullname",label:"姓名"}},[a("el-input",{model:{value:e.form.fullname,callback:function(a){e.$set(e.form,"fullname",a)},expression:"form.fullname"}})],1),a("el-form-item",{attrs:{label:"角色"}},[a("el-select",{attrs:{placeholder:"请选择角色",disabled:1==e.$route.params.user_id},model:{value:e.form.role_id,callback:function(a){e.$set(e.form,"role_id",a)},expression:"form.role_id"}},e._l(e.role_options,(function(e){return a("el-option",{key:e.role_id,attrs:{label:e.role_name,value:e.role_id}})})),1)],1),a("el-form-item",{attrs:{label:"性别"}},[a("el-radio-group",{model:{value:e.form.sex,callback:function(a){e.$set(e.form,"sex",a)},expression:"form.sex"}},[a("el-radio",{attrs:{label:"男"}}),a("el-radio",{attrs:{label:"女"}})],1)],1),a("el-form-item",{attrs:{prop:"tel",label:"手机"}},[a("el-input",{model:{value:e.form.tel,callback:function(a){e.$set(e.form,"tel",a)},expression:"form.tel"}})],1),a("el-form-item",{attrs:{prop:"email",label:"邮箱"}},[a("el-input",{model:{value:e.form.email,callback:function(a){e.$set(e.form,"email",a)},expression:"form.email"}})],1),a("el-form-item",{attrs:{label:"头像"}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{"on-success":e.handleUploadSuccess,"on-error":e.handleUploadError,data:{type:"avatar"},headers:e.headers,"before-upload":e.beforeAvatarUpload,accept:"image/*","show-file-list":!1,action:`${e.$server}/upload/common/`}},[e.form.avatar?a("img",{staticClass:"avatar",attrs:{src:e.form.avatar}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),a("el-button",{attrs:{type:"primary"},on:{click:e.handleEdit}},[e._v("保存修改")])],1)],1)},s=[],l=r(9551),o={name:"Edit",data(){return{form:{user_id:"",username:"",fullname:"",sex:"",role_id:"",tel:"",email:"",avatar:""},headers:{Authorization:`Bearer ${sessionStorage.access_token}`},role_options:[],rules:{fullname:[{required:!0,message:"请输入姓名！",trigger:"blur"}],tel:[{required:!0,message:"请输入手机号！",trigger:"blur"},{pattern:/^1((3|5|8){1}\d{1}|70)\d{8}$/,message:"请正确输入手机号！",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱！",trigger:"blur"},{pattern:/^[a-zA-Z0-9][a-zA-Z0-9_]+\@[a-zA-Z0-9]+\.(com|cn|net|com.cn)$/i,message:"请正确输入邮箱！",trigger:"blur"}]}}},mounted(){let{user_id:e}=this.$route.params;this.init(e)},beforeDestroy(){},beforeRouteLeave(e,a,r){r()},beforeRouteUpdate(e,a,r){let{user_id:t}=e.params;r(),this.init(t)},methods:{async init(e){let{status:a,data:r}=await l.uU.list();a&&(this.role_options={...r});let{status:t,data:s}=await l.wt.info({user_id:e});t&&(this.form={...s})},beforeAvatarUpload(e){let a=/^image\/(jpeg||png)$/;const r=a.test(e.type),t=e.size/1024/1024<2;return r||this.$message.error("上传头像图片只能是 JPG 格式!"),t||this.$message.error("上传头像图片大小不能超过 2MB!"),r&&t},handleUploadError(e,a,r){let{status:t,message:s}=e;switch(t){case 400:let{status:e,msg:a}=JSON.parse(s);this.$message.error(a);break;case 401:let{code:r}=JSON.parse(s);this.$message.error(`错误代码401,${r},请重新登录`);break;default:break}},handleUploadSuccess(e,a,r){let{status:t,msg:s,src:l}=e;t&&(this.form.avatar=l,this.$message.success(s))},async handleEdit(){try{let e=await this.$refs.form.validate();if(e){let{status:e,msg:a}=await l.wt.edit({...this.form});e?(this.$message.success(a),this.$router.go(-1)):this.$message.error(a)}}catch(e){}}}},i=o,m=r(1001),n=(0,m.Z)(i,t,s,!1,null,"ea156770",null),u=n.exports}}]);
//# sourceMappingURL=621.317db597.js.map