"use strict";(self["webpackChunkvue2_cms_admin"]=self["webpackChunkvue2_cms_admin"]||[]).push([[135],{9135:function(e,t,s){s.r(t),s.d(t,{default:function(){return c}});var i=function(){var e=this,t=e._self._c;return t("el-card",[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("权限设置")])]),t("el-steps",{attrs:{active:e.active,"finish-status":"success","align-center":""}},[t("el-step",{attrs:{title:"路由权限"}}),t("el-step",{attrs:{title:"菜单、操作权限"}})],1),t("div",{staticClass:"box"},[t("el-tree",{directives:[{name:"show",rawName:"v-show",value:0===e.active,expression:"active === 0"}],ref:"tree_route",attrs:{data:e.tree_data,"show-checkbox":"","node-key":"permission_id","default-expand-all":"",props:e.defaultProps_route,"check-strictly":!1}}),t("el-tree",{directives:[{name:"show",rawName:"v-show",value:1===e.active,expression:"active === 1"}],ref:"tree_menu",attrs:{data:e.tree_menu[0].children,"show-checkbox":"","node-key":"permission_id","default-expand-all":"",props:e.defaultProps_menu,"render-content":e.renderContent}})],1),t("div",{staticClass:"button"},[t("el-button",{directives:[{name:"show",rawName:"v-show",value:0===e.active,expression:"active === 0"}],staticStyle:{"margin-top":"12px"},attrs:{type:"primary"},on:{click:e.next}},[e._v("下一步")]),t("router-link",{directives:[{name:"show",rawName:"v-show",value:0===e.active,expression:"active === 0"}],staticClass:"link",attrs:{to:"/system/role"}},[t("el-button",{staticStyle:{"margin-top":"12px"}},[e._v("取消")])],1),t("el-button",{directives:[{name:"show",rawName:"v-show",value:1===e.active,expression:"active === 1"}],staticStyle:{"margin-top":"12px"},attrs:{type:"primary"},on:{click:function(t){e.active--}}},[e._v("上一步")]),t("el-button",{directives:[{name:"show",rawName:"v-show",value:1===e.active,expression:"active === 1"}],staticStyle:{"margin-top":"12px"},attrs:{type:"success"},on:{click:e.handlePreserve}},[e._v("保存设置")])],1)],1)},r=[],o=(s(7658),s(3822)),a={data(){return{active:0,defaultProps_route:{children:"children",label:"permission_remark"},defaultProps_menu:{children:"children",label:function(e,t){return"MENU"===e.resource_type_code?e.menu_name:"OPERATION"===e.resource_type_code?e.operation_name:void 0},disabled:""},permission_route:[],permission_menu:[]}},created(){let{role_id:e}=this.$route.params;this.reset_load_route(e),this.reset_load_menu(e)},watch:{route_limit(e){e.forEach((e=>{this.permission_route.push(e.permission_id)}))},menu_limit(e){e.forEach((e=>{this.permission_menu.push(e.permission_id)}))}},computed:{...(0,o.Se)("route",["tree_data"]),...(0,o.Se)("menu",["tree_menu"]),...(0,o.rn)("limit",["route_limit","menu_limit"])},methods:{...(0,o.nv)("limit",["load_route_limit","load_menu_limit"]),async reset_load_route(e){let{status:t,msg:s}=await this.load_route_limit({role_id:e});this.route_limit.forEach((e=>{this.permission_route.push(e.permission_id)}));const i=[];this.permission_route.forEach((e=>{const t=this.$refs.tree_route.getNode(e);t.isLeaf&&i.push(e)})),this.$refs.tree_route.setCheckedKeys(i,!0)},async reset_load_menu(e){let{status:t,msg:s}=await this.load_menu_limit({role_id:e});this.menu_limit.forEach((e=>{this.permission_menu.push(e.permission_id)}));const i=[];this.permission_menu.forEach((e=>{const t=this.$refs.tree_menu.getNode(e);t.isLeaf&&i.push(e)})),this.$refs.tree_menu.setCheckedKeys(i,!0)},next(){this.active++,this.permission_route=this.$refs.tree_route.getCheckedKeys();let e=this.$refs.tree_route.getHalfCheckedKeys();this.permission_route=[...this.permission_route,...e];let t=[];this.defaultProps_menu.disabled=(e,s)=>this.permission_route.includes(e.route_id)?(t.push(e.permission_id),!1):!t.includes(e.parent_id)},renderContent(e,{node:t,data:s,store:i}){return"MENU"===s.resource_type_code?e("span",{class:"custom-tree-node"},[e("i",{class:"el-icon-notebook-2",style:"color:#67c23a"}),e("span",{class:"text"},[t.label])]):"OPERATION"===s.resource_type_code?e("span",{class:"custom-tree-node"},[e("i",{class:"el-icon-s-operation",style:"color:#e6a23c"}),e("span",{class:"text"},[t.label])]):void 0},...(0,o.nv)("limit",["edit_route_limit","edit_menu_limit"]),async handlePreserve(){this.permission_route=this.$refs.tree_route.getCheckedKeys(),this.permission_menu=this.$refs.tree_menu.getCheckedKeys();let e=this.$refs.tree_route.getHalfCheckedKeys();this.permission_route=[...this.permission_route,...e];let t=this.$refs.tree_menu.getHalfCheckedKeys();this.permission_menu=[...this.permission_menu,...t];let{role_id:s}=this.$route.params,{status:i,msg:r}=await this.edit_route_limit({role_id:s,permissions:this.permission_route}),{status:o,msg:a}=await this.edit_menu_limit({role_id:s,permissions:this.permission_menu});i&&o?(this.$router.push("/system/role"),this.$message.success(a)):this.$message.error(a)}}},n=a,l=s(1001),u=(0,l.Z)(n,i,r,!1,null,"28d540f6",null),c=u.exports}}]);
//# sourceMappingURL=135.f4d352e1.js.map