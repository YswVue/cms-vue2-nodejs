{"version":3,"file":"js/135.f4d352e1.js","mappings":"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","sources":["webpack://vue2-cms-admin/./src/views/Role/Setting.vue","webpack://vue2-cms-admin/src/views/Role/Setting.vue","webpack://vue2-cms-admin/./src/views/Role/Setting.vue?bf69","webpack://vue2-cms-admin/./src/views/Role/Setting.vue?ef74"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('el-card',[_c('div',{staticClass:\"clearfix\",attrs:{\"slot\":\"header\"},slot:\"header\"},[_c('span',[_vm._v(\"权限设置\")])]),_c('el-steps',{attrs:{\"active\":_vm.active,\"finish-status\":\"success\",\"align-center\":\"\"}},[_c('el-step',{attrs:{\"title\":\"路由权限\"}}),_c('el-step',{attrs:{\"title\":\"菜单、操作权限\"}})],1),_c('div',{staticClass:\"box\"},[_c('el-tree',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.active === 0),expression:\"active === 0\"}],ref:\"tree_route\",attrs:{\"data\":_vm.tree_data,\"show-checkbox\":\"\",\"node-key\":\"permission_id\",\"default-expand-all\":\"\",\"props\":_vm.defaultProps_route,\"check-strictly\":false}}),_c('el-tree',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.active === 1),expression:\"active === 1\"}],ref:\"tree_menu\",attrs:{\"data\":_vm.tree_menu[0].children,\"show-checkbox\":\"\",\"node-key\":\"permission_id\",\"default-expand-all\":\"\",\"props\":_vm.defaultProps_menu,\"render-content\":_vm.renderContent}})],1),_c('div',{staticClass:\"button\"},[_c('el-button',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.active === 0),expression:\"active === 0\"}],staticStyle:{\"margin-top\":\"12px\"},attrs:{\"type\":\"primary\"},on:{\"click\":_vm.next}},[_vm._v(\"下一步\")]),_c('router-link',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.active === 0),expression:\"active === 0\"}],staticClass:\"link\",attrs:{\"to\":\"/system/role\"}},[_c('el-button',{staticStyle:{\"margin-top\":\"12px\"}},[_vm._v(\"取消\")])],1),_c('el-button',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.active === 1),expression:\"active === 1\"}],staticStyle:{\"margin-top\":\"12px\"},attrs:{\"type\":\"primary\"},on:{\"click\":function($event){_vm.active--}}},[_vm._v(\"上一步\")]),_c('el-button',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.active === 1),expression:\"active === 1\"}],staticStyle:{\"margin-top\":\"12px\"},attrs:{\"type\":\"success\"},on:{\"click\":_vm.handlePreserve}},[_vm._v(\"保存设置\")])],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n    <el-card>\r\n        <div slot=\"header\" class=\"clearfix\">\r\n            <span>权限设置</span>\r\n        </div>\r\n        <el-steps :active=\"active\" finish-status=\"success\" align-center>\r\n            <el-step title=\"路由权限\"></el-step>\r\n            <el-step title=\"菜单、操作权限\"></el-step>\r\n        </el-steps>\r\n        <div class=\"box\">\r\n            <!-- 路由设置 -->\r\n            <el-tree v-show=\"active === 0\" ref=\"tree_route\" :data=\"tree_data\" show-checkbox node-key=\"permission_id\"\r\n                default-expand-all :props=\"defaultProps_route\" :check-strictly=\"false\">\r\n            </el-tree>\r\n            <!-- 菜单设置 -->\r\n            <el-tree v-show=\"active === 1\" ref=\"tree_menu\" :data=\"tree_menu[0].children\" show-checkbox\r\n                node-key=\"permission_id\" default-expand-all :props=\"defaultProps_menu\" :render-content=\"renderContent\">\r\n            </el-tree>\r\n        </div>\r\n        <div class=\"button\">\r\n            <el-button v-show=\"active === 0\" type=\"primary\" style=\"margin-top: 12px;\" @click=\"next\">下一步</el-button>\r\n            <router-link v-show=\"active === 0\" to=\"/system/role\" class=\"link\">\r\n                <el-button style=\"margin-top: 12px;\">取消</el-button>\r\n            </router-link>\r\n            <el-button v-show=\"active === 1\" type=\"primary\" style=\"margin-top: 12px;\" @click=\"active--\">上一步</el-button>\r\n            <el-button v-show=\"active === 1\" @click=\"handlePreserve\" type=\"success\"\r\n                style=\"margin-top: 12px;\">保存设置</el-button>\r\n        </div>\r\n\r\n    </el-card>\r\n</template>\r\n\r\n<script>\r\nimport { mapActions, mapGetters, mapState } from 'vuex';\r\n\r\n// 存在未解决问题，菜单、操作按钮 的取消勾选问题\r\nexport default {\r\n    data() {\r\n        return {\r\n            active: 0,\r\n            // 路由 -- 默认状态\r\n            defaultProps_route: {\r\n                children: 'children',\r\n                label: 'permission_remark'\r\n            },\r\n            // 菜单/按钮 -- 默认状态\r\n            defaultProps_menu: {\r\n                children: 'children',\r\n                // 渲染 -- 菜单 or 按钮\r\n                label: function (data, node) {\r\n                    if (data.resource_type_code === 'MENU') {\r\n                        return data.menu_name;\r\n                    } else if (data.resource_type_code === 'OPERATION') {\r\n                        return data.operation_name;\r\n                    }\r\n                },\r\n                // 控制禁用\r\n                disabled: '',\r\n            },\r\n            permission_route: [],\r\n            permission_menu: [],\r\n        };\r\n    },\r\n    created() {\r\n        // 获取参数\r\n        let { role_id } = this.$route.params;\r\n        // 路由\r\n        this.reset_load_route(role_id);\r\n        // 菜单\r\n        this.reset_load_menu(role_id);\r\n    },\r\n    watch: {\r\n        route_limit(newValue) {\r\n            newValue.forEach(element => {\r\n                this.permission_route.push(element.permission_id);\r\n            });\r\n        },\r\n        menu_limit(newValue) {\r\n            newValue.forEach(element => {\r\n                this.permission_menu.push(element.permission_id);\r\n            });\r\n        }\r\n    },\r\n    computed: {\r\n        ...mapGetters('route', ['tree_data']),\r\n        ...mapGetters('menu', ['tree_menu']),\r\n        ...mapState('limit', ['route_limit', 'menu_limit']),\r\n\r\n    },\r\n    methods: {\r\n        ...mapActions('limit', ['load_route_limit', 'load_menu_limit']),\r\n        // 路由\r\n        async reset_load_route(role_id) {\r\n            let { status, msg } = await this.load_route_limit({ role_id });\r\n            this.route_limit.forEach(element => {\r\n                this.permission_route.push(element.permission_id);\r\n            });\r\n            // 回显 半选\r\n            const nodes = []\r\n            this.permission_route.forEach(item => {\r\n                const node = this.$refs.tree_route.getNode(item);\r\n                if (node.isLeaf) { //关键，过滤掉不是叶子节点的\r\n                    nodes.push(item)\r\n                }\r\n            })\r\n            this.$refs.tree_route.setCheckedKeys(nodes, true)\r\n        },\r\n        // 菜单 \r\n        async reset_load_menu(role_id) {\r\n            let { status, msg } = await this.load_menu_limit({ role_id });\r\n            this.menu_limit.forEach(element => {\r\n                this.permission_menu.push(element.permission_id);\r\n            });\r\n            // 回显 半选\r\n            const nodes = []\r\n            this.permission_menu.forEach(item => {\r\n                const node = this.$refs.tree_menu.getNode(item);\r\n                if (node.isLeaf) { //关键，过滤掉不是叶子节点的\r\n                    nodes.push(item)\r\n                }\r\n            })\r\n            this.$refs.tree_menu.setCheckedKeys(nodes, true) // 设置勾选数据\r\n        },\r\n        // 下一步\r\n        next() {\r\n            this.active++;\r\n            this.permission_route = this.$refs.tree_route.getCheckedKeys();//子级选中\r\n            let half_route = this.$refs.tree_route.getHalfCheckedKeys();//半选状态\r\n            // 新的权限路由 -- 包含半选的\r\n            this.permission_route = [...this.permission_route, ...half_route];\r\n            let arr = [];\r\n\r\n            // 可以尝试禁用时取消勾选 ------ 未做\r\n\r\n            this.defaultProps_menu.disabled = (data, node) => {\r\n                if (this.permission_route.includes(data.route_id)) {\r\n                    arr.push(data.permission_id)\r\n                    return false;\r\n                } else if (arr.includes(data.parent_id)) {\r\n                    return false;\r\n                }\r\n                return true;\r\n            }\r\n\r\n        },\r\n        // 区分 菜单/操作 \r\n        renderContent(h, { node, data, store }) {\r\n            if (data.resource_type_code === 'MENU') {\r\n                return (\r\n                    <span class=\"custom-tree-node\">\r\n                        <i class=\"el-icon-notebook-2\" style='color:#67c23a'></i>\r\n                        <span class='text'>{node.label}</span>\r\n                    </span>);\r\n            } else if (data.resource_type_code === 'OPERATION') {\r\n                return (\r\n                    <span class=\"custom-tree-node\">\r\n                        <i class=\"el-icon-s-operation\" style='color:#e6a23c'></i>\r\n                        <span class='text'>{node.label}</span>\r\n                    </span>);\r\n            }\r\n        },\r\n        // 保存设置\r\n        ...mapActions('limit', ['edit_route_limit', 'edit_menu_limit']),\r\n        async handlePreserve() {\r\n            // 此处未添加半选的父级\r\n            this.permission_route = this.$refs.tree_route.getCheckedKeys();\r\n            this.permission_menu = this.$refs.tree_menu.getCheckedKeys();\r\n\r\n            // 添加半选路由\r\n            let half_route = this.$refs.tree_route.getHalfCheckedKeys();\r\n            this.permission_route = [...this.permission_route, ...half_route];\r\n\r\n            // 添加半选菜单\r\n            let half_menu = this.$refs.tree_menu.getHalfCheckedKeys();\r\n            this.permission_menu = [...this.permission_menu, ...half_menu];\r\n\r\n            let { role_id } = this.$route.params;\r\n            let { status: route_staus, msg: route_msg } = await this.edit_route_limit({ role_id, permissions: this.permission_route })\r\n            let { status: menu_staus, msg: menu_msg } = await this.edit_menu_limit({ role_id, permissions: this.permission_menu })\r\n            if (route_staus && menu_staus) {\r\n                this.$router.push('/system/role')\r\n                this.$message.success(menu_msg);\r\n            } else {\r\n                this.$message.error(menu_msg)\r\n            }\r\n        }\r\n\r\n    }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.link {\r\n    margin-left: 10px;\r\n}\r\n\r\n.box {\r\n    border: 1px solid #409eff;\r\n    padding: 20px;\r\n    margin: 20px 0;\r\n}\r\n\r\n.text {\r\n    font-size: 14px;\r\n    padding-right: 5px;\r\n}\r\n</style>","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Setting.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Setting.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Setting.vue?vue&type=template&id=28d540f6&scoped=true&\"\nimport script from \"./Setting.vue?vue&type=script&lang=js&\"\nexport * from \"./Setting.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Setting.vue?vue&type=style&index=0&id=28d540f6&prod&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"28d540f6\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","attrs","slot","_v","active","directives","name","rawName","value","expression","ref","tree_data","defaultProps_route","tree_menu","children","defaultProps_menu","renderContent","staticStyle","on","next","$event","handlePreserve","staticRenderFns","data","label","node","resource_type_code","menu_name","operation_name","disabled","permission_route","permission_menu","created","role_id","$route","params","reset_load_route","reset_load_menu","watch","route_limit","newValue","forEach","element","push","permission_id","menu_limit","computed","mapGetters","mapState","methods","mapActions","status","msg","load_route_limit","nodes","item","$refs","tree_route","getNode","isLeaf","setCheckedKeys","load_menu_limit","getCheckedKeys","half_route","getHalfCheckedKeys","arr","includes","route_id","parent_id","h","store","half_menu","route_staus","route_msg","edit_route_limit","permissions","menu_staus","menu_msg","edit_menu_limit","$router","$message","success","error","component"],"sourceRoot":""}